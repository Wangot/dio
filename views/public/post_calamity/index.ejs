<!DOCTYPE html>
<html lang="en">
    <head>
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Readysaster- Hack for Resilience</title>

        <% stylesheet('/vendors/bootstrap/3.1.1/css/bootstrap.min.css') -%>
        <% stylesheet('/vendors/bootstrap/3.1.1/css/bootstrap-theme.min.css') -%>

        <% stylesheet('/public/css/style-home.css') -%>
        <% stylesheet('/public/css/font-awesome.css') -%>

        <% script('/vendors/jquery/1.11.0/jquery.min.js') -%>
        <% script('/vendors/bootstrap/3.1.1/js/bootstrap.min.js') -%>
        <% script('/vendors/angular/1.2.14/angular.min.js') -%>
        
         <% script('/public/js/jquery.tagcanvas.min.js') -%>

        <% script('/public/js/custom.js') -%>

        <%-stylesheets%>
        <%-scripts%>


        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
          <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
        
        <link rel="stylesheet" href="http://blueimp.github.io/Gallery/css/blueimp-gallery.min.css">       
        
        <link rel="stylesheet" href="public/css/bootstrap-image-gallery.min.css"> 

        <link rel="stylesheet" href="/public/css/jquery.fileupload.css">

        <!--[if lt IE 9]>
          <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
<link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" type="text/css" rel="stylesheet">


        <!-- CSS code from Bootply.com editor -->
        
<style type="text/css">
.navbar-form input, .form-inline input {
  width:auto;
}

body {
  padding-top:50px;
}

footer {
  margin-top:40px;
  padding-top:40px;
  padding-bottom:40px;
  background-color:#ededed;
}


#masthead {
  min-height:199px;
}

#masthead h1 {
  font-size: 55px;
  line-height: 1;
  margin-top:50px;
}

#masthead .well {
  margin-top:31px;
  min-height:127px;
}

.navbar.affix {
  position:fixed;
  top:0;
  width:100%;
}

.story-img {
  margin-top:25%;
  display:block;
}

a,a:hover {
  color:#223344;
  text-decoration:none;
}

.icon-bar {
  background-color:#fff;
}

@media screen and (min-width: 768px) {
  #masthead h1 {
    font-size: 80px;
  }
}

.dropdown-menu {
  min-width: 250px;
}

.panel {
  border-color:transparent;
  border-radius:0;
}

.thumbnail {
  margin-bottom:8px;
}

.img-container {
  overflow:hidden;
  height:170px;
}

.img-container img {
  min-width:280px;
  min-height:180px;
  max-width:380px;
  max-height:280px;
}

.txt-container {
  overflow:hidden;
  height:100px;
}

.panel .lead {
  overflow:hidden;
  height:90px;
}

.label-float{
  margin:0 auto;
  position: absolute;
  top: 0;
  z-index: 1;
  width:100%;
  opacity:.9;
  padding:6px;
  color:#fff;
}
    
.btn-twitter {background-color:#4099FF;color:#fff;}
.btn-facebook {background-color:#3B5998;color:#fff;}
.btn-google-plus {background-color:#d34836;color:#fff;}

.btn-twitter:hover {background-color:#3088FF;color:#62BBFF;}
.btn-facebook:hover {background-color:#2A4998;color:#4C6BBA;}
.btn-google-plus:hover {background-color:#C23836;color:#E45A58;}

#links a {
  width: 100px;
  height: 100px;
  display: inline-block;
}

#links img {
  max-width: 100%;
  max-height: 100%;
  position: relative;
}

.button-container {
  margin-top: 10px;
}

</style>
    </head>
    
    <!-- HTML code from Bootply.com editor -->
    
    <body>
        
        <div class="header">
                <div id="header" class="navbar">
                    <div class="navbar-inner">
                        <div class="container content">
                            <div class="navbar-header">
                                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                                    <span class="icon-reorder icon-2x"></span>
                                </button>
                                <a id="logo" class="navbar-brand">
                                    <span id="logo-img"><img src="public/images/logo.png" class="img-responsive"/></span>
                                    <p class="hidden-xs"><span style="color: #333">Alertness</span><span style="color: #0B87C2"> In Disaster</span></p>
                                </a> 
                                <!--<a id="logo" class="navbar-brand" href="#">DISASTERS<span style="color: #0B87C2">ALERT</span></a> -->
                            </div>
                            <div id="main-nav" class="navbar-collapse collapse">
                                <ul id="menu-container" class="nav navbar-nav pull-right">
                                     <li><a href="/">Home</a></li>
                                    <li><a href="/reports">Reports</a></li>
                                    <li><a href="">Get Involved</a></li>
                                    <li><a href="/disaster-feeds">Disaster Feeds</a></li>
                                    <li><a href="/login">Login</a></li>
                                    <li><a href="/register">Sign Up</a></li>
                                </ul>
                           </div><!--/.nav-collapse -->
                         </div>
                      </div>
                </div>
            </div>
<div class="post-disaster">
<div class="container content">
  <h3>POST DISASTER REPORTS</h3>
  <div class="row">
    
    <div class="col-md-12 pull-right"> 
      <div class="panel">
        <div class="panel-body">
          <div>
            <input type="text" class="form-control" placeholder="Compose new Report.." id="composeText">
          </div>
          <div class="button-container" style="display:none;">
            <input type="button" id="btnPost" class="btn btn-primary" value="Post">
            <a id="uploadImage" class="btn btn-primary"><i class="glyphicon glyphicon-camera"></i></a>

            <input id="fileupload" type="file" name="files[]" multiple class="hide">

            <div id="progress" class="progress">
              <div class="progress-bar progress-bar-success"></div>
            </div>
            <!-- The container for the uploaded files -->
            <div id="files" class="files"></div>

          </div>
        </div>
      </div>
    </div>

    <div class="col-md-12"> 
      
      <div class="panel">
        <div class="panel-body">
        
          
          <% for (var i in articles) {%>
            <div class="row">
              <br/>
                <div class="col-md-3 col-sm-3 text-center">
                 <img src="<%= articles[i].google_image_link %>">
                </div>
                <div class="col-md-9 col-sm-9">
                <h3><%= articles[i].title %></h3>
                  <p>
                    <%= articles[i].content %>
                      </p>
                      <div id="links">
                         <% for (var ii in articles[i].images) { %>
                            <a href="<%- articles[i].images[ii] %>" title="" data-gallery="blueimp<%= articles[i].id %>">
                              <img src="<%- articles[i].images[ii] %>">
                            </a>                        

                         <% } %>
                      </div>
                  <br/>                 
                  <p class="lead"><button class="btn btn-default">Read More</button></p>
                  <p class="pull-right">
                    <% for (var xx in articles[i].tags.split(',')) { %>
                    <span class="label label-default"><%- articles[i].tags.split(',')[xx] %></span> 
                    <% } %>
                  </p>
                  <ul class="list-inline">
                   <li>
                    <div class="fb-share-button" data-href="http://localhost:3000/disaster-feeds#<%= articles[i].id %>" data-type="button">
                    </div>
                  </li>
                  </ul>

                  <div class="fb-comments" data-href="http://localhost:3000/disaster-feeds#<%= articles[i].id %>" data-numposts="5" data-colorscheme="light">
                  </div>                 
                  </div>
                <div class="col-xs-3"></div>
              <br><br>
          </div>
          <hr>
                  
          <% } %>
        <a href="/" class="btn btn-primary pull-right btnNext">More <i class="glyphicon glyphicon-chevron-right"></i></a>                      
        </div>
      </div>
                                                                                       
	                                                
                                                      
   	</div><!--/col-12-->
  </div>
</div>
</div>
                                                                                
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Modal title</h4>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
<input type="hidden" id="articleId">

<div id="blueimp-gallery" class="blueimp-gallery">
    <!-- The container for the modal slides -->
    <div class="slides"></div>
    <!-- Controls for the borderless lightbox -->
    <h3 class="title"></h3>
    <a class="prev">‹</a>
    <a class="next">›</a>
    <a class="close">×</a>
    <a class="play-pause"></a>
    <ol class="indicator"></ol>
    <!-- The modal dialog, which will be used to wrap the lightbox content -->
    <div class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" aria-hidden="true">&times;</button>
                    <h4 class="modal-title"></h4>
                </div>
                <div class="modal-body next"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left prev">
                        <i class="glyphicon glyphicon-chevron-left"></i>
                        Previous
                    </button>
                    <button type="button" class="btn btn-primary next">
                        Next
                        <i class="glyphicon glyphicon-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
 
 <div id="footer" class="container content">
   <div class="col-sm-3 col-md-3">
       <h4>RELATED LINKS</h4>
       <ul>
           <li><a>Disaster Alert</a></li>
           <li><a>Help</a></li>
           <li><a>Contact</a></li>
           <li><a><i class="icon-facebook-sign"></i> Facebook</a></li>
       </ul>
   </div>         
   <div class="col-sm-5 col-md-5">
       <h4 id="appname">ABOUT A.I.D</h4>
       <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec blandit nibh suscipit venenatis facilisis. Nam eget felis 
       eget nisi pellentesque porta sed non tortor. Phasellus faucibus erat nec sem sodales, et bibendum tellus iaculis. Integer sit 
       amet diam et sem vestibulum lobortis in sed nulla. Donec lobortis vehicula tortor, at fringilla erat fringilla nec. </p>
   </div>         
   <div class="col-sm-4 col-md-4 hidden-xs">
       <h4>TEAM DIO</h4>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec blandit nibh suscipit venenatis facilisis. Nam eget felis 
       eget nisi pellentesque porta sed non tortor. Phasellus faucibus erat nec sem sodales, et bibendum tellus iaculis.</p>
   </div>         
</div>
                    
        <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>


        <script type='text/javascript' src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>

        <script src="http://blueimp.github.io/Gallery/js/jquery.blueimp-gallery.min.js"></script>

        <script src="/public/js/vendor/jquery.ui.widget.js"></script>

        <script src="http://blueimp.github.io/JavaScript-Load-Image/js/load-image.min.js"></script>
        <!-- The Canvas to Blob plugin is included for image resizing functionality -->
        <script src="http://blueimp.github.io/JavaScript-Canvas-to-Blob/js/canvas-to-blob.min.js"></script>
        <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
        <script src="/public/js/jquery.iframe-transport.js"></script>
        <!-- The basic File Upload plugin -->
        <script src="/public/js/jquery.fileupload.js"></script>
        <!-- The File Upload processing plugin -->
        <script src="/public/js/jquery.fileupload-process.js"></script>
        <!-- The File Upload image preview & resize plugin -->
        <script src="/public/js/jquery.fileupload-image.js"></script>
        <!-- The File Upload audio preview plugin -->
        <script src="/public/js/jquery.fileupload-audio.js"></script>
        <!-- The File Upload video preview plugin -->
        <script src="/public/js/jquery.fileupload-video.js"></script>
        <!-- The File Upload validation plugin -->
        <script src="/public/js/jquery.fileupload-validate.js"></script>

        <!-- 
        <script src="/public/js/bootstrap-image-gallery.min.js"></script>
         -->

        
        <!-- JavaScript jQuery code from Bootply.com editor -->
        
        <script type='text/javascript'>

        var formOpened = false;
        $(document).ready(function() {
          $(document).on('click', '#composeText', function() {
            if (formOpened == false) {

              $(this).attr('placeholder', 'Title');
              $(this).parent().append('<br/><textarea class="form-control" rows="4" id="composeTextArea" placeholder="Content"></textarea> <br/> <input type="text" class="form-control" id="composeTags" placeholder="Tags (ex: typhon, earthquake)">');

              $('#composeText').focus();
              $('.button-container').show();
              formOpened = true;
            }
          });

          $(document).on('click', '#uploadImage', function() {
            $('#fileupload').click();
          });

          $(document).on('click', '#btnPost', function() {
              $.ajax({
                url : '/api/article',
                data : { title: $('#composeText').val(), 
                         content : $('#composeTextArea').val(), 
                         tags : $('#composeTags').val()
                        },
                type: 'POST',
                dataType: 'json',
                success: function(data) {
                  if (data.status == 'success') {
                    var article_id = data.data.id;
                    $('#articleId').val(article_id)
                    $('#files').find('.btn-primary')
                               .click();
                  }
                }
              });
          });

            // Change this to the location of your server-side upload handler:
            var urls = window.location.hostname === 'blueimp.github.io' ?
                        '//jquery-file-upload.appspot.com/' : '/upload/image',
                uploadButton = $('<button/>')
                    .addClass('btn btn-primary hide')
                    .prop('disabled', true)
                    .text('Processing...')
                    .on('click', function () {
                        var $this = $(this),
                            data = $this.data();
                        $this
                            .off('click')
                            .text('Abort')
                            .on('click', function () {
                                $this.remove();
                                data.abort();
                            });
                        data.submit().always(function () {
                            $this.remove();
                        });
                    });
            $('#fileupload').fileupload({
                url: '/upload/image',
                dataType: 'json',
                autoUpload: false,
                acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
                maxFileSize: 5000000, // 5 MB
                // Enable image resizing, except for Android and Opera,
                // which actually support image resizing, but fail to
                // send Blob objects via XHR requests:
                disableImageResize: /Android(?!.*Chrome)|Opera/
                    .test(window.navigator.userAgent),
                previewMaxWidth: 100,
                previewMaxHeight: 100,
                previewCrop: true,
            }).on('fileuploadadd', function (e, data) {
                data.context = $('<div/>').appendTo('#files');
                $.each(data.files, function (index, file) {
                    var node = $('<p/>')
                            .append($('<span/>').text(file.name));
                    if (!index) {
                        node
                            .append('<br>')
                            .append(uploadButton.clone(true).data(data));
                    }
                    node.appendTo(data.context);
                });
            }).on('fileuploadprocessalways', function (e, data) {
                var index = data.index,
                    file = data.files[index],
                    node = $(data.context.children()[index]);
                if (file.preview) {
                    node
                        .prepend('<br>')
                        .prepend(file.preview);
                }
                if (file.error) {
                    node
                        .append('<br>')
                        .append($('<span class="text-danger"/>').text(file.error));
                }
                if (index + 1 === data.files.length) {
                    data.context.find('button')
                        .text('Upload')
                        .prop('disabled', !!data.files.error);
                }
            }).on('fileuploadprogressall', function (e, data) {
                var progress = parseInt(data.loaded / data.total * 100, 10);
                $('#progress .progress-bar').css(
                    'width',
                    progress + '%'
                );
            }).on('fileuploaddone', function (e, data) {
                $.each(data.result.files, function (index, file) {
                    if (file.url) {
                        var link = $('<a>')
                            .attr('target', '_blank')
                            .prop('href', file.url);
                        $(data.context.children()[index])
                            .wrap(link);
                    } else if (file.error) {
                        var error = $('<span class="text-danger"/>').text(file.error);
                        $(data.context.children()[index])
                            .append('<br>')
                            .append(error);
                    }
                });
            }).on('fileuploadfail', function (e, data) {
                $.each(data.files, function (index, file) {
                    var error = $('<span class="text-danger"/>').text('File upload failed.');
                    $(data.context.children()[index])
                        .append('<br>')
                        .append(error);
                });
            }).prop('disabled', !$.support.fileInput)
                .parent().addClass($.support.fileInput ? undefined : 'disabled');

          $('#fileupload').bind('fileuploadsubmit', function (e, data) {
              // The example input, doesn't have to be part of the upload form:
              var article_id = $('#articleId').val();
              data.formData = {article_id: article_id};
              if (!data.formData.article_id) {
                alert('Cannot upload images!');
                return false;
              }
          });                
/*
          $(document).on('blur', '#composeTextArea' ,function() {
            console.log('sdsd');
            $(this).parent().html('<input type="text" class="form-control" placeholder="Compose new Disaster.." id="composeText">');
            $('.button-container').hide();
          });
*/
            
        
        });
        

        </script>

        <script>
        /*jslint unparam: true, regexp: true */
        /*global window, $ */
        $(function () {
            
        });
        </script>        
        
        <div id="fb-root"></div>
        <script>(function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=759219867442538&version=v2.0";
          fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>
    </body>
</html>